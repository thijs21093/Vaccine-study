---
title: "REPORT CONTROL CHECK  V200"
author: "Thijs de Boer"
date: "2021"
output:
  html_document:
    code_folding: hide
    fig_captions: yes
    highlight: haddock
    number_sections: yes
    theme: flatly
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
      toc_depth: 3
---


Last update: `r Sys.time()`

```{r set-global-options, echo = FALSE}
knitr::opts_chunk$set(eval = TRUE, 
                      echo = TRUE, 
                      message=FALSE,
                      warning = FALSE,
                      cache = FALSE,
                      include = TRUE,
                      collapse = FALSE,
                      dependson = NULL,
                      engine = "R", #  Chunks will always have R code, unless noted
                      error = TRUE,
                      fig.path="Figures/",  #  Set the figure options
                      fig.align = "left",
                      fig.width = 6,
                      fig.height = 4)
```

```{r silent-packages, echo = FALSE, eval = TRUE, message=FALSE, include = FALSE}
library(sjPlot)
library(sjstats)
library(tidyverse)
library(car)
library(ggthemes)
library(kableExtra)
library(ggpubr)
library(scales)
library(ggpmisc)
library(tadaatoolbox)
library(data.table)
library(psych)
```

```{r}
load("C:/Users/Thijs/surfdrive/COVID vaccine/R data/git/Control/NL - control check/.RData")
load("C:/Users/Thijs/surfdrive/COVID vaccine/R data/git/Control/SE - control check/.RData")


df.def.SE["error"] <- 0

df.def.error <- dplyr::bind_rows(df.def.error.NL, df.def.SE)

df.def.error <- df.def.error %>% mutate(duration.quartile = case_when(
  duration <= quantile(duration, probs = 0.25) ~ "Q1",
  duration > quantile(duration, probs = 0.25) & duration <= quantile(duration, probs = 0.5)  ~ "Q2",
  duration > quantile(duration, probs = 0.5) & duration <= quantile(duration, probs = 0.75)  ~ "Q3",
  duration > quantile(duration, probs = 0.75) ~ "Q4"))
df.def.error$duration.quartile <- factor(df.def.error$duration.quartile, levels = c("Q1", "Q2", "Q3", "Q4"))

df.def <-  df.def.error %>%  
  filter(error == 0)
df.check <- dplyr::bind_rows(df.check.NL, df.check.SE)
df.total <- dplyr::bind_rows(df.total.NL, df.total.SE)

set_theme(
  base=theme_blank(),
  geom.outline.size = 0.01,
  geom.outline.color = "white", 
  geom.label.size = 3,
  geom.label.color = "grey50")
```

# Population

Total number of participants:
```{r}
df.total %>% nrow()
```

Number of participants that failed the attention test:
```{r}
df.total %>% nrow() - df.total %>% filter(IMC=="1") %>% nrow()
```

Participants between 0-17:
```{r}
df.total %>% filter(IMC=="1" & age < 18) %>% nrow()
```

Percentage of participants who are at least 18 years old and did not fail the IMC:
```{r}
percent(df.def.error %>% nrow() / df.total  %>% nrow())
```

Number of participants in this analysis:
```{r}
df.def.error %>% nrow()
```

With those who received the erroneous manipulation check removed:
```{r}
df.def.error %>% filter(error == 0)  %>%  nrow()
```

Number of participants in the final dataset that failed the manipulation check:
```{r}
df.def %>% nrow() - df.def %>% filter(manipulation.check=="1") %>% nrow()
```

Which is:
```{r}
percent(df.def %>% filter(manipulation.check!="1") %>% nrow() / df.def %>% nrow(), accuracy = 0.01)
```

<br>

# Experiment: Perceived independence of EMA

<br>

## Randomisation check
This table shows how many respondents are assigned to each experimental group.
```{r}
df.def %>%
  group_by(experimental.group) %>%
  tally()
```

<br>

## Description
```{r}
df.def %>% 
sjmisc::descr(perceived.independence.reversed, show = c("n", "NA.prc", "mean", "sd", "md", "iqr", "trimmed", "range", "skew")) %>%
  kbl(digits= 2) %>%
 kable_paper()
```

<br>

## Histogram

### Without those who received erroneous manipulation check
```{r}
ggarrange(df.def.error %>%
  ggplot(aes(x = perceived.independence.reversed, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha = 0.8, position = position_dodge()) + labs(y = "", title = "Total") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
  
  df.def.error %>% filter(country == "NL") %>% 
  ggplot(aes(x = perceived.independence.reversed, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha = 0.8, position = position_dodge()) + labs(y = "", title = "NL") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
  
    df.def.error %>% filter(country == "SE") %>% 
  ggplot(aes(x = perceived.independence.reversed, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha = 0.8, position = position_dodge()) + labs(y = "", title = "Sweden") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
  
  ncol = 3, common.legend = TRUE)
  
```

## Anova and T-test

### Total
```{r}
tadaa_aov(perceived.independence.reversed ~ experimental.group, data = df.def.error, print = "markdown")
```

### Sweden
```{r}
tadaa_aov(perceived.independence.reversed ~ experimental.group, data = df.def.SE, print = "markdown")
```

### Netherlands
```{r}
tadaa_t.test(data = df.def.NL, response = perceived.independence.reversed, group = experimental.group, print = "markdown")
```

# Credbility

## Full dataset

### Description
```{r}
df.def.error %>% 
sjmisc::descr(credibility.index, show = c("n", "NA.prc", "mean", "sd", "md", "iqr", "trimmed", "range", "skew")) %>%
  kbl(digits= 2) %>%
 kable_paper()
```

### Histogram
```{r}
ggarrange(df.def.error %>% ggplot(aes(x= credibility.index, color = experimental.group)) +
 geom_density(alpha= .1, linetype= "dashed") + theme(axis.title.y = element_blank()) + labs(y = "", title = "Total") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
 
 df.def.error %>% filter(country == "NL") %>% ggplot(aes(x= credibility.index, color = experimental.group)) +
 geom_density(alpha= .1, linetype= "dashed") + theme(axis.title.y = element_blank()) + labs(y = "", title = "Netherlands") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
 
  df.def.error %>% filter(country == "SE") %>% ggplot(aes(x= credibility.index, color = experimental.group)) +
 geom_density(alpha= .1, linetype= "dashed") + theme(axis.title.y = element_blank()) + labs(y = "", title = "Sweden") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
 
  ncol = 3, common.legend = TRUE)
 
```

### Anova and T-test

**Total**
```{r}
tadaa_aov(credibility.index ~ experimental.group, data = df.def.error, print = "markdown")
```

**Sweden**
```{r}
tadaa_aov(credibility.index ~ experimental.group, data = df.def.SE, print = "markdown")
```

**Netherlands**
```{r}
tadaa_t.test(data = df.def.NL, response = credibility.index, group = experimental.group, print = "markdown")
```
 
## credibility dimensions

### Non-interference
```{r}
df.def.error %>% select(credibility.item1:credibility.item3.reversed) %>% psych::alpha() -> alpha.noninterference

alpha.noninterference$total %>%
  kbl(digits= 2, caption = "Cronbach's alpha: non-interference") %>%
 kable_paper()
```

<br>

### expertise
```{r}
 df.def.error %>% select(credibility.item4,credibility.item5) %>% psych::alpha() -> alpha.expertise

alpha.expertise$total %>%
  kbl(digits= 2, caption = "Cronbach's alpha: expertise") %>%
 kable_paper()
```



## Filtering out those who failed the manipulation check 

Participants that received the erroneous manipulation check are filtered out as well.

### Description
```{r}
df.def %>% filter(manipulation.check.failed == "passed")  %>% 
sjmisc::descr(credibility.index, show = c("n", "NA.prc", "mean", "sd", "md", "iqr", "trimmed", "range", "skew")) %>%
  kbl(digits= 2) %>%
 kable_paper()
```

### Histogram
```{r}
ggarrange(df.def %>% filter(manipulation.check.failed == "passed")  %>% ggplot(aes(x= credibility.index, color = experimental.group)) +
 geom_density(alpha= .1, linetype= "dashed") + theme(axis.title.y = element_blank()) + labs(y = "", title = "Total") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
 
 df.def %>% filter(manipulation.check.failed == "passed" & country == "NL") %>% ggplot(aes(x= credibility.index, color = experimental.group)) +
 geom_density(alpha= .1, linetype= "dashed") + theme(axis.title.y = element_blank()) + labs(y = "", title = "Netherlands") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
 
 df.def %>%  filter(manipulation.check.failed == "passed" & country == "SE") %>% ggplot(aes(x= credibility.index, color = experimental.group)) +
 geom_density(alpha= .1, linetype= "dashed") + theme(axis.title.y = element_blank()) + labs(y = "", title = "Sweden") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Condition") +  scale_fill_viridis_d(name = "Condition") + 
  theme_tufte(),
 
  ncol = 3, common.legend = TRUE)
```

### Anova and T-test

**Total**
```{r}
tadaa_aov(credibility.index ~ experimental.group, data = df.check, print = "markdown")
```

**Sweden**
```{r}
tadaa_aov(credibility.index ~ experimental.group, data = df.check.SE, print = "markdown")
```

**Netherlands**
```{r}
tadaa_t.test(data = df.check.NL, response = credibility.index, group = experimental.group, print = "markdown")
```
 
      
- Analyze with the "policy credibility index" and breaking to the 3 dimensions. 


 
# Time

<br>

```{r include=FALSE}
table.duration <- df.def.error %>%
  dplyr::summarize(mean = mean(duration),
            sd = sd(duration),
            min = min(duration),
            q1 = quantile(duration, probs = 0.25),
            median = median(duration),
            q3 = quantile(duration, probs = 0.75),
            max = max(duration)) %>% round(digits = 2)

table.intro.submit <- df.def.error %>% 
   dplyr::summarize(mean = mean(intro.submit),
            sd = sd(intro.submit),
            min = min(intro.submit),
            q1 = quantile(intro.submit, probs = 0.25),
            median = median(intro.submit),
            q3 = quantile(intro.submit, probs = 0.75),
            max = max(intro.submit)) %>% round(digits = 2)

table.manipulation.submit <- df.def.error %>%  
   dplyr::summarize(mean = mean(manipulation.submit, na.rm = TRUE),
            sd = sd(manipulation.submit, na.rm = TRUE),
            min = min(manipulation.submit, na.rm = TRUE),
            q1 = quantile(manipulation.submit, probs = 0.25, na.rm = TRUE),
            median = median(manipulation.submit, na.rm = TRUE),
            q3 = quantile(manipulation.submit, probs = 0.75, na.rm = TRUE),
            max = max(manipulation.submit, na.rm = TRUE)) %>% round(digits = 2)

table.decision.submit <- df.def.error %>% 
   dplyr::summarize(mean = mean(decision.submit),
            sd = sd(decision.submit),
            min = min(decision.submit),
            q1 = quantile(decision.submit, probs = 0.25),
            median = median(decision.submit),
            q3 = quantile(decision.submit, probs = 0.75),
            max = max(decision.submit)) %>% round(digits = 2)
```

<br>

## Survey duration

<br>

### Histogram
```{r}
df.def.error %>% filter(duration < 30) %>% 
plot_frq((duration),
        geom.colors = alpha("red",0.8),
        type = "hist",
        geom.size = 0.25) +
  theme(axis.text = element_text(face = "bold",  size= 9)) + labs(title = "Total survey duration") +  scale_x_continuous(name="Time in minutes", breaks = seq(0,30, 2)) + scale_y_continuous(expand = expansion(c(0, 0.25))) + annotate(geom = "table", x = Inf, y = Inf, label = list(table.duration))
```

<br>


## Do participants read the information about the case?

<br>

### Page submission - introduction of case
```{r}
df.def.error %>% filter(intro.submit < 100) %>%  
plot_frq((intro.submit),
        geom.colors = alpha("dodgerblue2",0.8),
        type = "hist",
        geom.size = 1) + 
  theme(axis.text = element_text(face = "bold",  size= 9)) +
  scale_x_continuous(name="Time in seconds",breaks = seq(0,100,5)) + scale_y_continuous(expand = expansion(c(0, 0.1))) + annotate(geom = "table", x = Inf, y = Inf, label = list(table.intro.submit))
```

<br>


### Page submission - manipulation
```{r}
df.def.error %>% filter(manipulation.submit > 0 & manipulation.submit < 60) %>%  
plot_frq((manipulation.submit),
        geom.colors = alpha("dodgerblue2",0.8),
        type = "hist",
        geom.size = 1) + 
  theme(axis.text = element_text(face = "bold",  size= 9)) +
  scale_x_continuous(name="Time in seconds",breaks = seq(0,100,5)) + scale_y_continuous(expand = expansion(c(0, 0.1))) + annotate(geom = "table", x = Inf, y = Inf, label = list(table.intro.submit))
```

<br>

### Page submission - EMA's decision
```{r}
df.def.error %>% filter(decision.submit < 100) %>% 
plot_frq((decision.submit),
        geom.colors = alpha("dodgerblue2",0.8),
        type = "hist",
        geom.size = 1) + 
  theme(axis.text = element_text(face = "bold",  size= 9)) +
  scale_x_continuous(name= "Time in seconds", breaks = seq(0,100,5)) + scale_y_continuous(expand = expansion(c(0, 0.1))) + annotate(geom = "table", x = Inf, y = Inf, label = list(table.decision.submit))
```

<br>

## Time and ...

<br>

### ...experimental groups
```{r}
p5 <- df.def.error %>% filter(duration < 30) %>% ggplot(aes(x= duration, color = experimental.group, fill = experimental.group)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 2) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Total survey duration", x = "minutes") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

p6  <- df.def.error %>% filter(intro.submit < 60) %>% ggplot(aes(x= intro.submit, color = experimental.group, fill = experimental.group)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - introduction", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

p7 <- df.def.error %>% filter(manipulation.submit > 0 & manipulation.submit < 60) %>% ggplot(aes(x=manipulation.submit, color = experimental.group, fill = experimental.group)) +
 geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - manipulation", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

p8 <- df.def.error %>% filter(decision.submit < 60) %>% ggplot(aes(x=decision.submit, color = experimental.group, fill = experimental.group)) +
 geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - EMA's decision", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

ggarrange(p5, p6, p7, p8, nrow = 2, ncol = 2, labels="AUTO", legend = "bottom", common.legend = TRUE)
```


