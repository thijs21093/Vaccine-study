---
title: "Report COVID study POOLED V100"
author: "Thijs de Boer"
date: "2021"
output:
  html_document:
    code_folding: hide
    fig_captions: yes
    highlight: haddock
    number_sections: yes
    theme: flatly
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
      toc_depth: 3
---


Last update: `r Sys.time()`

```{r set-global-options, echo = FALSE}
knitr::opts_chunk$set(eval = TRUE, 
                      echo = TRUE, 
                      message=FALSE,
                      warning = FALSE,
                      cache = FALSE,
                      include = TRUE,
                      collapse = FALSE,
                      dependson = NULL,
                      engine = "R", #  Chunks will always have R code, unless noted
                      error = TRUE,
                      fig.path="Figures/",  #  Set the figure options
                      fig.align = "left",
                      fig.width = 6,
                      fig.height = 4)
```

```{r silent-packages, echo = FALSE, eval = TRUE, message=FALSE, include = FALSE}
library(sjPlot)
library(sjstats)
library(tidyverse)
library(car)
library(ggthemes)
library(kableExtra)
library(ggpubr)
library(scales)
library(ggpmisc)
library(tadaatoolbox)
library(rockchalk)
library(lme4)
library(janitor)
library(sjmisc)
library(lavaan)
library(semPlot)
```

```{r}
load("C:/Users/Thijs/surfdrive/COVID vaccine/git/POOLED/.RData")

set_theme(
  base=theme_blank(),
  geom.outline.size = 0.01,
  geom.outline.color = "white", 
  geom.label.size = 3,
  geom.label.color = "grey50")
```


# Population

Total number of cases, removed cases and final cases (complete cases):
```{r}
t1 <- df.total %>% filter(Finished == 1) %>%  
  group_by(country) %>% 
  tally() %>% 
  mutate(percentage = ((n/nrow(df.total %>% filter(Finished == 1))*100) %>% round(1))) %>%
  adorn_totals("row")

t2 <- df.total %>% filter(Finished == 1 & IMC != 1 | age < 18) %>%  
  group_by(country) %>% 
  tally() %>% 
  mutate(percentage = ((n/nrow(df.total %>% filter(Finished == 1 & IMC != 1 | age < 18))*100) %>% round(1))) %>%
  adorn_totals("row")

t3 <- merge(x = t1, y = t2, by = "country", all.x = TRUE) %>%  mutate(n.final = (n.x-n.y),
        percentage.final = (n.final/nrow(df.total %>% filter(Finished == 1 & IMC == 1 & age >= 18))*100) %>% round(1),
        ratio = ((n.x-n.y)/n.x) %>% round(2)) 

t3 %>% 
  kable(col.names = c("",
                      "n",
                      "%",
                      "n",
                      "%",
                      "n",
                      "%",
                      "Ratio (final/total)"
                      ),
        align=rep('c', 5)) %>% 
    kable_styling(bootstrap_options = c( "condensed",  "striped", "hover"),
                full_width = F,
                position = "left")  %>% add_header_above(c(" ", "Total"  = 2, "Failed IMC or under 18" = 2, "Final" = 2, " "))  %>%
   column_spec(column = 2:8, width = "2cm")
```

One case discrepancy??
```{r}
pooled %>% filter(Finished == 1) %>% nrow
```


Number of participants in the final dataset that failed the manipulation check:
```{r}
t4 <- pooled %>%  filter(Finished == 1) %>%
   group_by(country, manipulation.check.failed)%>%
  summarise(n=n()) %>%
  spread(manipulation.check.failed, n) %>%
  adorn_totals("row")  %>% mutate(
   missing =  `<NA>`,
   missing = tidyr::replace_na(missing, 0),
   total = (failed + passed + missing),
  percentage = (passed/(total)*100) %>% round(2)) %>% relocate(failed, .after = passed)

t4 %>% select(-`<NA>`) %>% 
  kable(col.names = c("",
                      "Passed",
                      "Failed",
                      "Missing",
                      "Total",
                      "% Passed")) %>% 
    kable_styling(bootstrap_options = c("condensed", "striped", "hover"),
                full_width = F,
                position = "left")
```

<br>

# Summary statistics
```{r,results="asis", echo=FALSE,warning=FALSE,message=FALSE}
q1 <- pooled %>% 
  select(expertise,
         stability,
         noninterference,
         credibility.index,
         perceived.independence.reversed,
         intent.vaccine,
         
         trust.EC,
         trust.EP,
         trust.council,
         trust.scientist,
         trust.politicians,
         trust.media,
         political.ideology,
         EU.integration,
         interpersonal.trust,
         familiarity.EMA,
         familiarity.advice,
         credibility.EMA.pre,
         credibility.EMA.post,
         trust.health.authorities,
         consequences.health,
         consequences.economic,
         importance.EMA,
         importance.FDA ,
         importance.NRA,
         private.providers,
         knowledge,
         benefits.vaccines,
         
         independence,
         advice,
         no.text,
         
         female,
         healthcare,
         age) %>% 
  descr() %>% 
  data.frame() %>% 
  select(-type,
         -label,
         -se,
         -iqr,
         -trimmed,) %>% 
mutate_at(vars(c("NA.prc","mean","sd","md", "skew")),funs(round(.,3))) %>%
  mutate(var = c(
"1. Credibility (expertise)",
"2. Credibility (stability)",
"3. Credibility (non-interference)",
"4. Credibility.index",
"5. Perceived political independence",
"6. Vaccination intention",
"7. Trust in European Commission",
"8. Trust in European Parliament",
"9. Trust in Council of European Union",
"10. Trust in scientists",
"11. Trust in politicians",
"12. Trust in the media",
"13. Political ideology (left-right)",
"14. Support for EU integration",
"15. Interpersonal trust",
"16. Familiarity with EMA",
"17. FAmiliarity with EMA's advice",
"18. Crebility of EMA (pre-manipulation)",
"19. Crebility of EMA (post-manipulation)",
"20. Trust in public health authorities",
"21. Consequences of coronacrisis for health",
"22. Consequences of coronacrisis for income",
"23. Importance of EMA's advice",
"24. Importance of other regulators' advice",
"25. Importance of NRA's advice",
"26. Believe in private markets",
"27. Knowledge of coronacrisis",
"28. Benefits of vaccines",
"29. Independence condition",
"30. Advice condition",
"31. No text condtion",
"32. Gender (Female = 1)",
"33. Works in healthcare",
"34. Age"))
rownames(q1) <- 1:nrow(q1)
# check integration


q1 %>% 
  kable(col.names = c("Variable",
                       "n",
                      "% missing",
                      "Mean",
                      "SD",
                      "Median",
                      "Range",
                      "Skew")) %>% 
    kable_styling(bootstrap_options = c("condensed", "striped", "hover"),
                full_width = F,
                position = "left")
```

<br>

```{r}
pooled %>% 
  select(expertise,
         stability,
         noninterference,
         credibility.index,
         perceived.independence.reversed,
         intent.vaccine,
         
         trust.EC,
         trust.EP,
         trust.council,
         trust.scientist,
         trust.politicians,
         trust.media,
         political.ideology,
         EU.integration,
         interpersonal.trust,
         familiarity.EMA,
         familiarity.advice,
         credibility.EMA.pre,
         credibility.EMA.post,
         trust.health.authorities,
         consequences.health,
         consequences.economic,
         importance.EMA,
         importance.FDA ,
         importance.NRA,
         private.providers,
         knowledge,
         benefits.vaccines,
         independence,
         advice,
          female,
          healthcare,
         age) %>% 
  tab_corr(triangle="lower",
           remove.spaces=T,
           p.numeric = T,
           show.p = T,
           fade.ns = F,
           digits = 2,
           na.deletion="pairwise",
           var.labels = str_c("Variable ", c(1:30,32:34)))
```

<br>

Note that I removed variable 31 from the correlation plot as it gives an error during computation.

# Outcome variables

In this section we provide additional details about out outcome variables -- the three aspects of policy credibility. We report the distributions and correlations of the six survey items. Thereafter, we include the R code and results of our confirmatory factor analysis.   


## Distributions of items

Item 1: I believe that the EMA's opinion was based strictly on scientific considerations. 

```{r}
pooled %>%
  ggplot(aes(x=credibility.item1, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha=0.8)+
  scale_x_continuous(name="",limits = c(0,8),breaks = 1:7)+
  scale_fill_manual(values = c("dodgerblue1", "dodgerblue2","dodgerblue3", "dodgerblue4"))+
  facet_grid(experimental.group ~ country,  margins=TRUE, scale="free") + 
  theme_tufte() +
  theme(legend.position = "none", axis.title = element_blank())
```

<br>

Item 2: I believe that the EMA's opinion was influenced by political interests. (reversed)


```{r}
pooled %>%
  ggplot(aes(x=credibility.item2.reversed, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha=0.8)+
  scale_x_continuous(name="",limits = c(0,8),breaks = 1:7)+
  scale_fill_manual(values = c("dodgerblue1", "dodgerblue2","dodgerblue3", "dodgerblue4"))+
  facet_grid(experimental.group ~ country,  margins=TRUE, scale="free") + 
  theme_tufte() +
  theme(legend.position = "none", axis.title = element_blank())
```

<br>

Item 3: I believe that the EMA's opinion was affected by the industry interests. (reversed)


```{r}
pooled %>%
  ggplot(aes(x=credibility.item3.reversed, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha=0.8)+
  scale_x_continuous(name="",limits = c(0,8),breaks = 1:7)+
  scale_fill_manual(values = c("dodgerblue1", "dodgerblue2","dodgerblue3", "dodgerblue4"))+
  facet_grid(experimental.group ~ country,  margins=TRUE, scale="free") + 
  theme_tufte() +
  theme(legend.position = "none", axis.title = element_blank())
```

<br>

Item 4: I believe that the EMA's opinion was formed after evaluating all the relevant data and evidence. 

```{r}
pooled %>%
  ggplot(aes(x=credibility.item4, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha=0.8)+
  scale_x_continuous(name="",limits = c(0,8),breaks = 1:7)+
  scale_fill_manual(values = c("dodgerblue1", "dodgerblue2","dodgerblue3", "dodgerblue4"))+
  facet_grid(experimental.group ~ country,  margins=TRUE, scale="free") + 
  theme_tufte() +
  theme(legend.position = "none", axis.title = element_blank())
```

<br>

Item 5: I believe that the assessment of the evidence was based on adequate methods. 

```{r}
pooled %>%
  ggplot(aes(x=credibility.item5, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha=0.8)+
  scale_x_continuous(name="",limits = c(0,8),breaks = 1:7)+
  scale_fill_manual(values = c("dodgerblue1", "dodgerblue2","dodgerblue3", "dodgerblue4"))+
  facet_grid(experimental.group ~ country,  margins=TRUE, scale="free") + 
  theme_tufte() +
  theme(legend.position = "none", axis.title = element_blank())
```

<br>

Item 6: Assuming that the scientific evidence does not change, I believe that EMA's opinion about the Pfizer-BioNTech vaccine will not change the next time EMA is asked to re-examine it.

```{r}
pooled %>%
  ggplot(aes(x=credibility.item6, fill = experimental.group)) +
  geom_bar(width = 0.75,alpha=0.8)+
  scale_x_continuous(name="",limits = c(0,8),breaks = 1:7)+
  scale_fill_manual(values = c("dodgerblue1", "dodgerblue2","dodgerblue3", "dodgerblue4"))+
  facet_grid(experimental.group ~ country,  margins=TRUE, scale="free") + 
  theme_tufte() +
  theme(legend.position = "none", axis.title = element_blank())
```

<br>

**Correlation matrix**

```{r}
pooled.credibility <-pooled %>% 
  select(credibility.item1:credibility.item6)

pooled.credibility %>% 
  tab_corr(triangle="lower",
           remove.spaces=T,
           p.numeric = T,
           fade.ns = T,
           digits = 2,
           na.deletion="pairwise",
           title = "Correlation matrix: items of policy credibility scale",
           var.labels = str_c("Item ",1:6))
```

<br>

```{r include=FALSE}
factor.1.cfa <- 'policy.credibility  =~ credibility.item1 + credibility.item2.reversed + credibility.item3.reversed + credibility.item4 + credibility.item5 + credibility.item6'

factor.3.cfa <- 'non.interference  =~ credibility.item1 + credibility.item2.reversed + credibility.item3.reversed
expert.based =~ credibility.item4 + credibility.item5
stability   =~ credibility.item6'

factor.3.cfa.alt <- 'non.interference.alt  =~  credibility.item2.reversed + credibility.item3.reversed
              expert.based.alt =~ credibility.item1 + credibility.item4 + credibility.item5
              stability.alt   =~ credibility.item6'

factor.3.cfa.second <- 'non.interference  =~ credibility.item1 + credibility.item2.reversed + credibility.item3.reversed
              expert.based =~ credibility.item4 + credibility.item5
              stability   =~ credibility.item6
      policy.credibility =~ non.interference + expert.based + stability
non.interference ~~ expert.based
expert.based ~~ stability'

factor.3.cfa.alt.second <- 'non.interference.alt  =~  credibility.item2.reversed + credibility.item3.reversed
              expert.based.alt =~ credibility.item1 + credibility.item4 + credibility.item5
              stability.alt   =~ credibility.item6
      policy.credibility.alt =~ non.interference.alt + expert.based.alt + stability.alt
non.interference.alt ~~ expert.based.alt
expert.based.alt ~~ stability.alt'
```


# Conformitory factor analysis

We conducted our confirmatory factor analysis using `R lavaan` package.

<br>

**One-factor model:**
```{r,echo = TRUE}
fit.1factor <- cfa(factor.1.cfa, 
           std.lv=TRUE,  
           missing="fiml",  
           data=pooled.credibility)

summary(fit.1factor,fit.measures=T,standardize=T)
```

<br>

**Three-factors model:**
```{r,echo = TRUE}
fit.3factors <- cfa(factor.3.cfa, 
           std.lv=TRUE,  
           missing="fiml",  
           data=pooled.credibility)

summary(fit.3factors,fit.measures=T,standardize=T)
```

<br>

**Three-factors model alternative:**

<br>

In this model, item 1 is part of 'expertise-based' instead of 'non-interference'.

<br>

```{r,echo = TRUE}
fit.3factors.alt <- cfa(factor.3.cfa.alt, 
           std.lv=TRUE,  
           missing="fiml",  
           data=pooled.credibility)

summary(fit.3factors.alt, fit.measures=T, standardize=T)
```

## A closer look

### Three factors (original dimensions)

<br>

**comparison with one-factor model**
```{r,echo = TRUE}
anova(fit.3factors, fit.1factor)
```

**Visualization of the model**
```{r}
semPaths(fit.3factors, "std", weighted = FALSE, nCharNodes = 7, shapeMan = "rectangle",
         sizeMan = 8,  intercepts = FALSE, edge.label.cex = 1, curvePivot = TRUE) 
```

**Factor loading**
```{r}
parameterEstimates(fit.3factors, standardized=TRUE) %>% 
  filter(op == "=~") %>% 
  select('Latent Factor'=lhs, Indicator=rhs, B=est, SE=se, Z=z, 'p-value'=pvalue, Beta=std.all) %>% 
  mutate(Indicator = str_c("Item ",1:6)) %>% 
  kable(digits = 3)%>% 
    kable_styling(bootstrap_options = c("condensed"),
                full_width = F,
                position = "left")%>%
  collapse_rows(columns = 1, valign = "top")
```
<br>

### Three factors (alternative)

**comparison with one-factor model**
```{r,echo = TRUE}
anova(fit.3factors.alt, fit.1factor)
```

**Visualization of the model**
```{r}
semPaths(fit.3factors.alt, "std", weighted = FALSE, nCharNodes = 7, shapeMan = "rectangle",
         sizeMan = 8,  intercepts = FALSE, edge.label.cex = 1, curvePivot = TRUE) 
```

**Factor loading**
```{r}
parameterEstimates(fit.3factors.alt, standardized=TRUE) %>% 
  filter(op == "=~") %>% 
  select('Latent Factor'=lhs, Indicator=rhs, B=est, SE=se, Z=z, 'p-value'=pvalue, Beta=std.all) %>% 
  mutate(Indicator = str_c("Item ",1:6)) %>% 
  kable(digits = 3)%>% 
    kable_styling(bootstrap_options = c("condensed"),
                full_width = F,
                position = "left")%>%
  collapse_rows(columns = 1, valign = "top")
```

## How does it look if we include a second order latent variable?

**Three-factors model with second order:**
```{r message=TRUE, warning=TRUE, include=FALSE}
fit.3factors.second <- cfa(factor.3.cfa.second, 
           data=pooled.credibility)

summary(fit.3factors.second, standardize=T)
```
**Visualization of the model**
```{r message=TRUE, warning=TRUE, paged.print=FALSE}
semPaths(fit.3factors.second, "std", weighted = FALSE, nCharNodes = 7, shapeMan = "rectangle",
         sizeMan = 8,  intercepts = FALSE, edge.label.cex = 1, curvePivot = TRUE) 
```

<br >

**Three-factors model alternative with second order:**

<br>

```{r message=TRUE, warning=TRUE, include=FALSE}
fit.3factors.alt.second <- cfa(factor.3.cfa.alt.second, 
           data=pooled.credibility,
           missing="fiml")

summary(fit.3factors.alt.second, fit.measures=T, standardize=T)
```


**Visualization of the model**
```{r}
semPaths(fit.3factors.alt.second, "std", weighted = FALSE, nCharNodes = 7, shapeMan = "rectangle",
         sizeMan = 8,  intercepts = FALSE, edge.label.cex = 1, curvePivot = TRUE) 
```

Both models have issues. Further investigation is needed to determine the cause of this problem. Theoretically, it would make sense to add a second order as we expect the three dimensions to be related. That is, we see these dimensions as part of a bigger latent variable ("policy credibility").

<br>

# Experiment: Perceived independence of EMA

<br>

## Randomisation check
This table shows how many respondents are assigned to each experimental group.
```{r}
pooled %>%
  group_by(experimental.group) %>%
  tally() %>%
  kable(col.names = c("Experimental group", "n")) %>%
    kable_styling(bootstrap_options = c("condensed", "striped", "hover"),
                full_width = F,
                position = "left") 
```

<br>

## Histogram
```{r}
pooled %>%
  ggplot(aes(x = perceived.independence.reversed, fill = experimental.group)) +
  geom_bar(width = 0.9, position = position_dodge()) + scale_y_continuous(name="") +
  scale_x_continuous(name="", breaks = 1:7) + scale_fill_manual(name = "Independence group") +  scale_fill_viridis_d(name = "Independence group") + facet_grid(~country, margins = T) + theme(strip.text = element_text(hjust = 0, face = "bold"),
    legend.position="bottom",
    aspect.ratio = 2.5)
```

<br>

## T-test

```{r}
pooled  %>% ggplot(aes(x = experimental.group, y = perceived.independence.reversed, color = experimental.group)) +
      stat_summary(fun.data = mean_cl_normal, geom = "errorbar", alpha = 0.5, width = 0.1, size = 1, position = position_dodge(0.5)) + labs(color ='Experimental group', x = "", y = "Perceived independence") +
    stat_summary(fun = mean, geom = "point", alpha = 0.5, size = 2 , position = position_dodge(0.5)) +  facet_grid(.~country, margins = TRUE) +  theme(axis.text.x = element_blank())
```

<br>

### With complete dataset (only advice/independence)
```{r}
tadaa_t.test(data = pooled.experiment, response = perceived.independence.reversed, group = experimental.group, print = "markdown")
```

<br>

### With those who failed the manipulation check filtered out (only advice/independence)
```{r}
tadaa_t.test(data = pooled.experiment, response = perceived.independence.reversed, group = experimental.group, print = "markdown")
```

<br>

### Anova?

# Time

<br>

```{r include=FALSE}
table.duration <- pooled %>%
  dplyr::summarize(mean = mean(duration),
            sd = sd(duration),
            min = min(duration),
            q1 = quantile(duration, probs = 0.25),
            median = median(duration),
            q3 = quantile(duration, probs = 0.75),
            max = max(duration)) %>% round(digits = 2)

table.intro.submit <- pooled %>% 
   dplyr::summarize(mean = mean(intro.submit),
            sd = sd(intro.submit),
            min = min(intro.submit),
            q1 = quantile(intro.submit, probs = 0.25),
            median = median(intro.submit),
            q3 = quantile(intro.submit, probs = 0.75),
            max = max(intro.submit)) %>% round(digits = 2)

table.manipulation.submit <- pooled %>% drop_na(manipulation.submit) %>% 
   dplyr::summarize(mean = mean(manipulation.submit),
            sd = sd(manipulation.submit),
            min = min(manipulation.submit),
            q1 = quantile(manipulation.submit, probs = 0.25),
            median = median(manipulation.submit),
            q3 = quantile(manipulation.submit, probs = 0.75),
            max = max(manipulation.submit)) %>% round(digits = 2)

table.decision.submit <- pooled %>% 
   dplyr::summarize(mean = mean(decision.submit),
            sd = sd(decision.submit),
            min = min(decision.submit),
            q1 = quantile(decision.submit, probs = 0.25),
            median = median(decision.submit),
            q3 = quantile(decision.submit, probs = 0.75),
            max = max(decision.submit)) %>% round(digits = 2)
```

<br>

## Survey duration

<br>

### Histogram
```{r}
pooled %>% filter(duration < 30) %>% 
plot_frq((duration),
        geom.colors = alpha("red",0.8),
        type = "hist",
        geom.size = 0.25) +
  theme(axis.text = element_text(face = "bold",  size= 9)) + labs(title = "Total survey duration") +  scale_x_continuous(name="Time in minutes", breaks = seq(0,30, 2)) +  scale_y_continuous(expand = expansion(c(0, 0.25))) + annotate(geom = "table", x = Inf, y = Inf, label = list(table.duration))
```

<br>

## Do participants read the information about the case?

<br>

### Page submission - introduction of case
```{r}
pooled %>% filter(intro.submit < 100) %>%  
plot_frq((intro.submit),
        geom.colors = alpha("dodgerblue2",0.8),
        type = "hist",
        geom.size = 1) + 
  theme(axis.text = element_text(face = "bold",  size= 9)) +
  scale_x_continuous(name="Time in seconds",breaks = seq(0,100,5)) +   scale_y_continuous(expand = expansion(c(0, 0.1))) + annotate(geom = "table", x = Inf, y = Inf, label = list(table.intro.submit))
```

<br>

### Page submission - manipulation

<br>

*Histogram*
```{r}
pooled %>% filter(manipulation.submit < 100) %>%
plot_frq((manipulation.submit),
        geom.colors = alpha("dodgerblue2",0.8),
        type = "hist",
        geom.size = 1) +
  theme(axis.text = element_text(face = "bold",  size= 9)) +
  scale_x_continuous(name="Time in seconds",breaks = seq(0,100,5)) +   scale_y_continuous(expand = expansion(c(0, 0.1))) + annotate(geom = "table", x = Inf, y = Inf, label = list(table.manipulation.submit))
```

<br>

*Broken down in quartiles per counry and total*
```{r}
t9 <- pooled.experiment  %>% ggplot(aes(x = manipulation.submit.quartile,y = perceived.independence.reversed, color = experimental.group)) +
      stat_summary(fun.data = mean_cl_normal, geom = "errorbar", alpha = 0.5, width = 0.1, size = 1, position = position_dodge(0.5)) + labs(color ='Experimental group', x = "Page submission - manipulation (quartiles)", y = "Perceived independence") +
    stat_summary(fun = mean, geom = "point", alpha = 0.5, size = 2 , position=position_dodge(0.5)) +  facet_grid(. ~ country, margins = TRUE) +  theme_tufte()
  
ggarrange(t9, common.legend = TRUE, legend = "bottom")
```

<br>

*Split dataset with 30 seconds as cut-off point*
```{r}
give.n <- function(x){
  return(c(y = mean(x)*1.15, label = length(x))) 
}

t10 <- pooled.experiment  %>% ggplot(aes(x = manipulation.submit.30,y = perceived.independence.reversed, color = experimental.group)) +
      stat_summary(fun.data = mean_cl_normal, geom = "errorbar", alpha = 0.5, width = 0.1, size = 1, position = position_dodge(0.25)) + labs(color ='Experimental group', x = "Page submission - manipulation", y = "Perceived independence") +
    stat_summary(fun = mean, geom = "point", alpha = 0.5, size = 2 , position=position_dodge(0.25)) +  facet_grid(. ~ country, margins = TRUE) +
  stat_summary(fun.data = give.n, geom = "text", fun = median, size = 4, col = "black") + theme_tufte()
  
ggarrange(t10, common.legend = TRUE, legend = "bottom")
```

### Page submission - EMA's decision
```{r}
pooled %>% filter(decision.submit < 100) %>% 
plot_frq((decision.submit),
        geom.colors = alpha("dodgerblue2",0.8),
        type = "hist",
        geom.size = 1) + 
  theme(axis.text = element_text(face = "bold",  size= 9)) +
  scale_x_continuous(name= "Time in seconds", breaks = seq(0,100,5)) +   scale_y_continuous(expand = expansion(c(0, 0.1))) + annotate(geom = "table", x = Inf, y = Inf, label = list(table.decision.submit))
```

<br>

### Time and ...

<br>

***...Failing the manipulation check***

```{r}
t10 <- pooled.experiment %>% filter(duration < 30) %>% drop_na(manipulation.check.failed) %>%
  ggplot(aes(x= duration, color = manipulation.check.failed, fill = manipulation.check.failed)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 2) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Total survey duration", x = "minutes") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t11  <- pooled.experiment %>% filter(intro.submit < 60) %>% drop_na(manipulation.check.failed) %>% ggplot(aes(x= intro.submit, color = manipulation.check.failed, fill = manipulation.check.failed)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - introduction", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t12 <- pooled.experiment %>% filter(manipulation.submit < 60) %>% drop_na(manipulation.check.failed) %>% ggplot(aes(x=manipulation.submit, color = manipulation.check.failed, fill = manipulation.check.failed)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) + geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - manipulation", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t13 <- pooled.experiment %>% filter(decision.submit < 60) %>% drop_na(manipulation.check.failed) %>% ggplot(aes(x=decision.submit, color =manipulation.check.failed, fill = manipulation.check.failed)) + 
 geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - EMA's decision", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

ggarrange(t10, t11, t12, t13, nrow = 2, ncol = 2, labels="AUTO", legend = "bottom", common.legend = TRUE)

# Change legend title
```

<br>

***...experimental groups***

```{r}
t14 <- pooled.experiment %>% filter(duration < 30) %>% ggplot(aes(x= duration, color = experimental.group, fill = experimental.group)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 2) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Total survey duration", x = "minutes") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t15  <- pooled.experiment %>% filter(intro.submit < 60) %>% ggplot(aes(x= intro.submit, color = experimental.group, fill = experimental.group)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - introduction", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t16 <- pooled.experiment %>% filter(manipulation.submit < 60) %>% ggplot(aes(x=manipulation.submit, color = experimental.group, fill = experimental.group)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) + geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - manipulation", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t17 <- pooled.experiment %>% filter(decision.submit < 60) %>% ggplot(aes(x=decision.submit, color = experimental.group, fill = experimental.group)) +
 geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - EMA's decision", x = "seconds", color = "Manipulation Check") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

ggarrange(t14, t15, t16, t17, nrow = 2, ncol = 2, labels="AUTO", legend = "bottom", common.legend = TRUE)
```

<br>

T-tests (outliers removed - i.e., cases outside 1.5 times the interquartile range):
```{r include=FALSE}
out.duration <- boxplot(pooled$duration, plot=FALSE)$out
out.duration <-pooled[-which(pooled$duration %in% out.duration),]

out.intro.submit <- boxplot(pooled$intro.submit, plot=FALSE)$out
out.intro.submit <-pooled[-which(pooled$intro.submit %in% out.intro.submit),]

out.manipulation.submit <- boxplot(pooled$manipulation.submit, plot=FALSE)$out
out.manipulation.submit <-pooled[-which(pooled$manipulation.submit %in% out.manipulation.submit),]

out.decision.submit <- boxplot(pooled$decision.submit, plot=FALSE)$out
out.decision.submit <-pooled[-which(pooled$decision.submit %in% out.decision.submit),]
```

***Survey duration***
```{r}
tadaa_t.test(data = out.duration, response = duration, group = experimental.group, print = "markdown")
```

***Page submission - Introduction***
```{r}
tadaa_t.test(data = out.intro.submit, response = intro.submit, group = experimental.group, print = "markdown")
```

***Page submission - manipulation***
```{r}
tadaa_t.test(data = out.manipulation.submit, response = manipulation.submit, group = experimental.group, print = "markdown")
```

***Page submission - decision***
```{r}
tadaa_t.test(data = out.decision.submit, response = decision.submit, group = experimental.group, print = "markdown")
```

<br>

***...interface (pc/mobile)***

```{r}
t18 <- pooled %>% filter(duration < 30) %>% ggplot(aes(x= duration, color = device, fill = device)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 2) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Total survey duration", x = "minutes") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t19 <- pooled %>% filter(intro.submit < 60) %>% ggplot(aes(x= intro.submit, color = device, fill = device)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - introduction", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t20 <- pooled %>% filter(manipulation.submit < 60) %>% ggplot(aes(x=manipulation.submit, color = device, fill = device)) + geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) + geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - manipulation", x = "seconds") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

t21 <- pooled %>% filter(decision.submit < 60) %>% ggplot(aes(x=decision.submit, color = device, fill = device)) +
 geom_histogram(aes(y=..density..), alpha=0.5, position="identity", binwidth = 5) +
 geom_density(alpha= .1, linetype= "dashed") + labs(title = "Page submission - EMA's decision", x = "seconds", color = "Manipulation Check") + theme(axis.title.y = element_blank(), title = element_text(size = 7, face = "bold"),  axis.text = element_text(size = 9))

ggarrange(t18, t19, t20, t21, nrow = 2, ncol = 2, labels="AUTO", legend = "bottom", common.legend = TRUE)
```

<br>

# Vaccination intention
```{r}
pooled %>%
  ggplot(aes(intent.vaccine, group = country)) + 
          geom_bar(aes(y = ..prop..), stat="count") + 
          scale_y_continuous(labels=scales::percent) +
          labs(y = "relative frequencies", x = "Vaccination intension") +
          facet_grid(~country, margins = TRUE) + theme_light()


```

<br>

## Open question
```{r}
pooled %>% 
  filter(nchar(Q16.3)>1) %>% 
  select(Q16.3) %>% 
  kable() %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%    scroll_box(height = "400px")
```

<br>

# Interface (mobile/pc)

<br>

## Distribution
```{r}
pooled %>%
  plot_frq(device,
        ylim = c(0,nrow(pooled)),
        geom.colors = alpha("dodgerblue1",0.8))+
  theme_blank()
```

<br>

## Distribution of perceived independence for mobile/pc
```{r}
t23 <- pooled %>%
  drop_na(perceived.independence.reversed) %>% filter(device == "pc") %>% 
  ggplot(aes(x = perceived.independence.reversed, fill = experimental.group)) + labs(title = "PC") + 
  geom_bar(width = 0.8, alpha = 1, position = position_dodge()) +
  scale_x_continuous(name="Perceived independence", breaks = 1:7) + scale_y_continuous(name="") + ylim(c(0,400)) +  scale_fill_manual(name = "Independence condition", values = c("dodgerblue2","dodgerblue4")) +
theme(plot.title = element_text(face = "bold")) +  scale_fill_viridis_d(name = "Independence condition")

t24 <- pooled %>% filter(device == "mobile") %>% 
  ggplot(aes(x = perceived.independence.reversed, fill = experimental.group)) + labs(title = "Mobile") + 
  geom_bar(width = 0.8, alpha = 1, position = position_dodge())+
  scale_x_continuous(name="Perceived independence", breaks = 1:7) + scale_y_continuous(name="") + ylim(c(0,400)) + 
  scale_fill_manual(name = "Independence condition", values = c("dodgerblue2","dodgerblue4")) +
theme(plot.title = element_text(face = "bold")) +  scale_fill_viridis_d(name = "Independence condition")

ggarrange(t23, t24,
          ncol = 2,nrow = 1, common.legend = TRUE, labels = "AUTO")
```

<br>

### T-test
```{r}
tadaa_t.test(data = pooled.experiment, response = perceived.independence.reversed, group = device, print = "markdown")
```

<br>

# Demography

## Age {.tabset}

### France
```{r}
age.population.FR <- read.csv("C:/Users/Thijs/surfdrive/COVID vaccine/git/FR/AGE_FR-08022021.csv")

age.population.FR <- age.population.FR %>% mutate(agecat = case_when(age < 25 ~ "younger than 25",
          age >= 25 & age < 30 ~ "25-29",
          age >= 30 & age < 35 ~ "30-34",
          age >= 35 & age < 40 ~ "35-39",
          age >= 40 & age < 45 ~ "40-44",
          age >= 45 & age < 50 ~ "45-49",
          age >= 50 & age < 55 ~ "50-54",
          age >= 55 & age < 60 ~ "55-59",
          age >= 60 & age < 65 ~ "60-64",
          age >= 65 & age < 70 ~ "65-69",
          age >= 70 & age < 75 ~ "70-74",
          age >= 75 & age < 80 ~ "75-79",
          age >= 80 ~ "80 or older"))
  
age.population.5.FR <- age.population.FR %>% group_by(agecat) %>% tally(count) %>% mutate(percentage = n / sum(n))

age.total.FR <- merge(age.population.5.FR, age.sample.FR, by.x = "agecat", by.y = "age.5")

age.total.FR <- age.total.FR %>% 
  rename(age.category = agecat,
  count.population = n.x,
  count.sample = n.y,
  percentage.population = percentage.x,
  percentage.sample = percentage.y)

age.total.FR$age.category <- factor(age.total.FR$age.category, levels = c(
"younger than 25",
"25-29",           "30-34",           "35-39",          
"40-44",           "45-49",           "50-54",          
"55-59",           "60-64",           "65-69",          
"70-74",           "75-79",           "80 or older"))    

age.total.FR %>% select(age.category, percentage.population, percentage.sample) %>% reshape2::melt(id.vars = 'age.category', variable.name = 'series')  %>% ggplot(aes(age.category, value, colour = series, fill = series)) + geom_bar (stat="identity", width=0.9, position = position_dodge(width=0.9)) + 
  theme_blank() + theme(legend.position="top", axis.text.x = element_text(angle = 45, hjust = 1), axis.title  = element_blank()) + scale_y_continuous(labels=scales::percent)
```

<br>

### Netherlands
```{r}
age.population.5.NL <- read.csv("C:/Users/Thijs/surfdrive/COVID vaccine/git/NL/AGE_POPULATION_SEGMENTS_NL-22012021.csv")

age.total.NL <- merge(age.population.5.NL, age.sample.NL, by.x = "ï..age", by.y = "age.5")

age.total.NL <- age.total.NL %>% 
  rename(age.category = ï..age,
  count.population = count,
  count.sample = n,
  percentage.population = percentage.x,
  percentage.sample = percentage.y)

age.total.NL$age.category <- factor(age.total.NL$age.category, levels = c(
"younger than 25",
"25-29",           "30-34",           "35-39",          
"40-44",           "45-49",           "50-54",          
"55-59",           "60-64",           "65-69",          
"70-74",           "75-79",           "80 or older"))    

age.total.NL %>% select(age.category, percentage.population, percentage.sample) %>% reshape2::melt(id.vars = 'age.category', variable.name = 'series')  %>% ggplot(aes(age.category, value, colour = series, fill = series)) + geom_bar (stat="identity", width=0.9, position = position_dodge(width=0.9)) + 
  theme_blank() + theme(legend.position="top", axis.text.x = element_text(angle = 45, hjust = 1), axis.title  = element_blank()) + scale_y_continuous(labels=scales::percent)
```

### Ireland
```{r}

age.population.5.IE <- read.csv("C:/Users/Thijs/surfdrive/COVID vaccine/git/EN/AGE_POPULATION_SEGMENTS_EN_25012021.csv")

age.total.IE <- merge(age.population.5.IE, age.sample.IE, by.x = "ï..age", by.y = "age.5")

age.total.IE  <- age.total.IE  %>% 
  rename(age.category = ï..age,
  count.population = count,
  count.sample = n,
  percentage.population = percentage.x,
  percentage.sample = percentage.y)

age.total.IE$age.category <- factor(age.total.IE$age.category, levels = c(
"younger than 25",
"25-29",           "30-34",           "35-39",          
"40-44",           "45-49",           "50-54",          
"55-59",           "60-64",           "65-69",          
"70-74",           "75-79",           "80 or older"))    

age.total.IE  %>% select(age.category, percentage.population, percentage.sample) %>% reshape2::melt(id.vars = 'age.category', variable.name = 'series')  %>% ggplot(aes(age.category, value, colour = series, fill = series)) + geom_bar (stat="identity", width=0.9, position = position_dodge(width=0.9)) + 
  theme_blank() + theme(legend.position="top", axis.text.x = element_text(angle = 45, hjust = 1), axis.title  = element_blank()) + scale_y_continuous(labels=scales::percent)
```

### Sweden
```{r}
age.population.5.SE <- read.csv("C:/Users/Thijs/surfdrive/COVID vaccine/git/SE/AGE_POPULATION_SEGMENTS_SE-22012021.csv")
age.total.SE <- merge(age.population.5.SE, age.sample.SE, by.x = "age", by.y = "age.5")

age.total.SE <- age.total.SE %>% 
  rename(age.category = age,
  count.population = count,
  count.sample = n,
  percentage.population = percentage.x,
  percentage.sample = percentage.y)

age.total.SE$age.category <- factor(age.total.SE$age.category, levels = c(
"younger than 25",
"25-29",           "30-34",           "35-39",          
"40-44",           "45-49",           "50-54",          
"55-59",           "60-64",           "65-69",          
"70-74",           "75-79",           "80 or older"))    

age.total.SE %>% select(age.category, percentage.population, percentage.sample) %>% reshape2::melt(id.vars = 'age.category', variable.name = 'series')  %>% ggplot(aes(age.category, value, colour = series, fill = series)) + geom_bar (stat="identity", width=0.9, position = position_dodge(width=0.9)) + 
  theme_blank() + theme(legend.position="top", axis.text.x = element_text(angle = 45, hjust = 1), axis.title  = element_blank()) + scale_y_continuous(labels=scales::percent)
```


## Gender
```{r}
pooled %>% 
plot_frq(female,
                ylim = c(0,nrow(pooled)),
        axis.labels = c("Male","Female"),
        title = "Gender")+ 
  theme_blank()
```

<br>

## Education



## Income


<br>

## Province

<br>

## Works in healthcare sector
```{r}
pooled %>% 
  plot_frq(healthcare,
        ylim = c(0,nrow(pooled)+500),
        title = "") + 
  theme_blank()
```

<br>

# Pre-post

## Distribution of credibility EMA (post)
```{r}
pooled %>% count(credibility.EMA.post) %>%  mutate(percentage = (n/(sum(n))*100) %>% round(2))  %>%
  adorn_totals("row") %>%  kable(col.names = c("Credibility EMA (post)", "n", "%")) %>% 

    kable_styling(bootstrap_options = c("condensed", "striped", "hover"),
                full_width = F,
                position = "left")
```

<br >

As this variable was added later to the survey, there is substantial missing data for this variable.

<br >

## Plot
```{r warning=TRUE}
t26 <- pooled  %>% 
  select(experimental.group,
         credibility.EMA.pre,
         credibility.EMA.post,
         country) %>% drop_na(credibility.EMA.post) %>%
  gather("key","value",-experimental.group, -country) %>% 
  mutate(key = recode(key,"'credibility.EMA.pre'='0.Pre';'credibility.EMA.post'='1.Post'"))
  
t26 %>% ggplot(aes(x=key,y=value,color=experimental.group))+
      stat_summary(fun.data = mean_cl_normal, geom = "errorbar", alpha=0.5,width=0.1,size=1,position=position_dodge(0.5)) + 
  stat_summary(fun = mean, geom = "point", alpha=0.5,size=2,position=position_dodge(0.5))+
  stat_summary(fun = mean, geom = "line", alpha=0.5,size=1,position=position_dodge(0.5), aes(group = experimental.group)) + labs(color ='Experimental group', x = "", y = "") + facet_grid(~country, margins = TRUE) +
  theme_tufte()
```

<br >

## Regression {.tabset}

### Total

**Models**
```{r}
prepost.total <- pooled %>% mutate(id = row_number()) %>% 
  select(experimental.group,
         id,
         credibility.EMA.pre,
         credibility.EMA.post,
         country) %>%
  drop_na() %>%
  gather("key","value",-experimental.group,-id,-country) %>% 
  mutate(post = key %>% Recode("'credibility.EMA.pre'= 0;'credibility.EMA.post'=1"),
         credibility = value) 


m1 <- lmer(credibility ~ post + (1|id),
                       data = prepost.total)

m2 <- m1 %>% update(.~.+experimental.group) 


m3 <- m2 %>% update(.~. + post*experimental.group)


tab_model(m2, m3,
          show.ci = F,
          show.se = T,
          collapse.se = T,
          emph.p = F)
```

<br >

**Interaction effect**
```{r}
plot_model(m3, type = "int")
```

### Ireland

**Models**
```{r}
prepost.IE <- prepost.total %>% filter(country == "IE")

m5 <- lmer(credibility ~ post + (1|id), data = prepost.IE)

m6 <- m5 %>% update(.~.+experimental.group) 

m7 <- m6 %>% update(.~. + post*experimental.group)

tab_model(m6, m7,
          show.ci = F,
          show.se = T,
          collapse.se = T,
          emph.p = F)
```

<br > 

**Interaction effect**
```{r}
plot_model(m7, type = "int")
```

### Sweden
```{r}
prepost.SE <- prepost.total %>% filter(country == "SE")

m8 <- lmer(credibility ~ post + (1|id),
                       data = prepost.SE)

m9 <- m8 %>% update(.~.+ experimental.group) 

m10 <- m9 %>% update(.~. + post*experimental.group)

tab_model(m9, m10,
          show.ci = F,
          show.se = T,
          collapse.se = T,
          emph.p = F)
```

<br > 

**Interaction effect**
```{r}
plot_model(m10, type = "int")
```

### France

**Models**
```{r}
prepost.FR <- prepost.total %>% filter(country == "FR")

m11 <- lmer(credibility ~ post + (1|id),
                       data = prepost.FR)

m12 <- m11 %>% update(.~.+ experimental.group) 

m13 <- m12 %>% update(.~. + post*experimental.group)

tab_model(m12, m13,
          show.ci = F,
          show.se = T,
          collapse.se = T,
          emph.p = F)
```

<br > 

**Interaction effect**
```{r}
plot_model(m13, type = "int")
```

<br > 

# Regression

<br>

## Perceived independence
```{r}
reg.perceived.independence1 <- lm(perceived.independence.reversed ~  trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income,
                    data = pooled,
                    na.action = na.omit)

reg.perceived.independence2 <- lm(perceived.independence.reversed ~ credibility.index + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic +  EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income,
                    data = pooled,
                    na.action = na.omit)


tab_model(reg.perceived.independence1, reg.perceived.independence2,  show.ci = FALSE)
```

<br >

## Vaccination intension
```{r}
reg.intent.vaccine1 <- glm(intent.vaccine.recoded ~ trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + age + healthcare + income,
                    data = pooled,
                    na.action = na.omit,
                    family = binomial(link = 'logit'))

reg.intent.vaccine2 <- glm(intent.vaccine.recoded ~ credibility.index + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + age + healthcare + income,
                    data = pooled,
                    na.action = na.omit,
                    family = binomial(link = 'logit'))

reg.intent.vaccine3 <- glm(intent.vaccine.recoded ~ perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + age + healthcare + income,
                    data = pooled,
                    na.action = na.omit,
                    family = binomial(link = 'logit'))

reg.intent.vaccine4 <- glm(intent.vaccine.recoded ~ credibility.index + perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + age + healthcare + income,
                    data = pooled,
                    na.action = na.omit,
                    family = binomial(link = 'logit'))

tab_model(reg.intent.vaccine1, reg.intent.vaccine2, reg.intent.vaccine3, reg.intent.vaccine4, show.ci = FALSE)
```

<br>

## Crebility of EMA's decision
```{r}
reg.credibility1 <- lm(credibility.index  ~ trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice + political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income,
                    data = pooled,
                    na.action = na.omit)

reg.credibility2 <- lm(credibility.index  ~ perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income,
                    data = pooled,
                    na.action = na.omit)

reg.credibility3 <- lm(credibility.index  ~ perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA +  + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income + perceived.independence.reversed:benefits.vaccines + benefits.vaccines:experimental.group,
                    data = pooled,
                    na.action = na.omit)

reg.credibility4 <- lm(credibility.index  ~ perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA +  + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + age.recoded + healthcare + income + perceived.independence.reversed:benefits.vaccines + benefits.vaccines:experimental.group,
                    data = pooled,
                    na.action = na.omit)


reg.credibility3.centered <- meanCenter(reg.credibility3, centerOnlyInteractors = TRUE, centerDV = FALSE)

reg.credibility4.centered <- meanCenter(reg.credibility4, centerOnlyInteractors = TRUE, centerDV = FALSE)

tab_model(reg.credibility1, reg.credibility2, reg.credibility3.centered, show.ci = FALSE)
```


_Note: Interaction variables are centered in the third model_

<br>


### Plots

***Interaction effect: perceived independence x benefits of vaccines***
```{r}
plot_model(reg.credibility3.centered, type = "int", mdrt.values = "meansd")[[1]]
```

***Interaction effect: perceived independence x experimental group***
```{r}
plot_model(reg.credibility3.centered, type = "int", mdrt.values = "meansd")[[2]]
```

***marginal effects: Effect of perceived independence on credibility for different age groups***
```{r}
plot_model(reg.credibility4.centered, type = "pred", terms = c("perceived.independence.reversedc", "age.recoded"))
```

## Full models - filtered

### Perceived independence
```{r}
reg.perceived.independence.30 <- lm(perceived.independence.reversed ~ credibility.index + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic +  EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income,
                    data = df.30,
                    na.action = na.omit)

reg.perceived.independence.check <- lm(perceived.independence.reversed ~ credibility.index + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic +  EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income,
                    data = df.check,
                    na.action = na.omit)

tab_model(reg.perceived.independence.30, reg.perceived.independence.check, dv.labels = c("Perceived independence (filter = page submission)", "Perceived independence (filter = manipulation check)"), show.ci = FALSE)
```

### Vaccination intention
```{r eval=FALSE, include=FALSE}
reg.intent.vaccine.30 <- glm(intent.vaccine.recoded ~ credibility.index + perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + age + healthcare + income,
                    data = df.30,
                    na.action = na.omit,
                    family = binomial(link = 'logit'))

reg.intent.vaccine.check  <- glm(intent.vaccine.recoded ~ credibility.index + perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + age + healthcare + income,
                    data = df.check,
                    na.action = na.omit,
                    family = binomial(link = 'logit'))

tab_model(reg.intent.vaccine.30, reg.intent.vaccine.check, dv.labels = c("Vaccination intention (filter = page submission)", "Vaccination intention (filter = manipulation check)"), show.ci = FALSE)
```

Too few cases.

### Credibility index
```{r}
reg.credibility.30 <- lm(credibility.index  ~ perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA +  + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income + perceived.independence.reversed:benefits.vaccines + benefits.vaccines:experimental.group,
                    data = df.30,
                    na.action = na.omit)

reg.credibility.check <- lm(credibility.index  ~ perceived.independence.reversed + trust.politicians + trust.scientist + trust.EC + trust.health.authorities + interpersonal.trust + benefits.vaccines + credibility.EMA.post + familiarity.EMA +  + familiarity.advice +  political.ideology + consequences.health + consequences.economic + EU.integration + private.providers + knowledge +  experimental.group + female + poly(age, 2) + healthcare + income + perceived.independence.reversed:benefits.vaccines + benefits.vaccines:experimental.group,
                    data = df.check,
                    na.action = na.omit)

tab_model(reg.credibility.30, reg.credibility.check, dv.labels = c("Credibility (filter = page submission)",  "Credibility (filter = manipulation check)"), show.ci = FALSE)
```

<br>

# Remarks from participants
```{r}
df.total %>% 
  filter(nchar(comments.general)>1) %>% 
  select(comments.general) %>% 
  kable() %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%    scroll_box(height = "400px")
```